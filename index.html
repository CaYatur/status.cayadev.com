<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>cayadev.com — Durum</title>
  <link rel="icon" type="image/png" href="assets/CaYaDevSite.png">

  <style>
    :root{
      --bg-1:#061124; --bg-2:#081827; --card:#0b1220; --muted:#9ca3af;
      --ok:#16a34a; --bad:#ef4444; --accent:#38bdf8; --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background: linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:#e6eef8;}
    .container{max-width:1100px;margin:20px auto;padding:16px}
    .shell{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:14px; overflow:hidden; box-shadow: 0 12px 50px rgba(2,6,23,.6);
      border:1px solid rgba(255,255,255,0.03);
    }

    .top {
      display:flex; gap:18px; align-items:center; padding:16px 20px;
      background: linear-gradient(90deg, rgba(255,255,255,0.01), transparent);
    }
    .brand { display:flex; gap:14px; align-items:center; min-width:320px; }
    .logo-wrap{
      width:92px; height:92px; border-radius:14px; overflow:hidden; flex:0 0 92px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      display:flex; align-items:center; justify-content:center; box-shadow: 0 8px 24px rgba(2,6,23,.45);
    }
    .logo-wrap img{width:86px;height:86px;object-fit:contain; display:block}
    .brand h1{font-size:20px;margin:0;color:#fff;letter-spacing:0.2px}

    .actions { margin-left:auto; display:flex; gap:12px; align-items:center; }
    .btn-site{
      background: linear-gradient(90deg,var(--accent), #2fb8ff);
      color:#022; padding:10px 14px; border-radius:10px; font-weight:700; text-decoration:none;
      box-shadow: 0 8px 22px rgba(56,189,248,.12);
    }

    .status-pill{
      display:flex; align-items:center; gap:12px; padding:12px 14px; border-radius:999px;
      background: rgba(255,255,255,0.02); min-width:240px; justify-content:center; margin-top:12px;
    }
    .status-pill.ok{ background: linear-gradient(90deg, rgba(22,163,74,0.95), rgba(16,148,71,0.95)); color:#fff; }
    .status-pill.bad{ background: linear-gradient(90deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95)); color:#fff; }

    /* single-column main (aside removed) */
    .main{display:block; padding:18px}
    @media (max-width:960px){ .brand{min-width:unset} .logo-wrap{width:76px;height:76px} }
    @media (max-width:640px){
      .top{flex-direction:column;align-items:center;gap:12px;padding:14px}
      .brand{flex-direction:column;align-items:center;text-align:center;min-width:unset}
      .logo-wrap{width:120px;height:120px;border-radius:16px}
      .logo-wrap img{width:110px;height:110px}
      .actions{width:100%;justify-content:center}
      .status-pill{width:100%; border-radius:12px; padding:12px; justify-content:center; min-width:unset; margin-top:6px}
      .main{padding:14px; gap:12px}
    }

    .card{ background:var(--card); padding:14px; border-radius:12px; border:1px solid var(--glass); }
    .overview{ display:flex; gap:12px; align-items:center; }
    .big-dot{width:20px;height:20px;border-radius:50%;background:var(--muted)}
    .big-dot.up{background:var(--ok);box-shadow:0 8px 28px rgba(22,163,74,.12)}
    .big-dot.down{background:var(--bad);box-shadow:0 8px 28px rgba(239,68,68,.12)}
    .status-text{font-weight:700;font-size:16px}
    .meta{color:var(--muted);font-size:13px;margin-top:6px}

    .stats-grid{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    .stat{ flex:1 1 160px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding:12px; border-radius:10px; min-width:140px; border:1px solid rgba(255,255,255,0.02); }
    .stat .label{color:var(--muted); font-size:12px}
    .stat .value{font-weight:700; font-size:18px; margin-top:6px}

    /* History styles */
    .history{margin-top:12px; max-height:520px; overflow:auto; padding:6px; border-radius:8px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .history .row{display:flex; justify-content:space-between; padding:12px; border-radius:8px; align-items:center}
    .history .row:nth-child(odd){background:rgba(255,255,255,0.01)}
    .history .row small{display:block;color:var(--muted);font-size:13px}
    .history .row .state{font-weight:700}
    .reverted{opacity:.6; font-style:italic; color:var(--muted)}

    /* Compact list mode when more than 3 items */
    .history-list{ list-style: disc inside; padding-left:18px; margin:0; }
    .history-list li{ padding:8px 6px; border-bottom:1px solid rgba(255,255,255,0.02); font-size:14px; display:flex; justify-content:space-between; align-items:center; }
    .history-list li:last-child{ border-bottom: none; }
    .history-list .ts{ color:var(--muted); font-size:13px; margin-right:12px; white-space:nowrap; }
    .history-list .st{ font-weight:700; }

    footer{padding:14px 18px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <div class="shell" role="main" aria-live="polite">
      <div class="top" aria-hidden="false">
        <div class="brand" role="banner">
          <div class="logo-wrap" aria-hidden="false">
            <img src="assets/CaYaDev.png" alt="CaYaDev logo" onerror="this.style.display='none'">
          </div>
          <div>
            <h1>cayadev.com</h1>
          </div>
        </div>

        <div class="actions" aria-hidden="false">
          <a class="btn-site" href="https://cayadev.com" target="_blank" rel="noopener noreferrer">Siteye Git</a>
        </div>
      </div>

      <div class="main">
        <div>
          <div class="card">
            <div class="overview">
              <div id="bigDot" class="big-dot" aria-hidden="true"></div>
              <div>
                <div id="stateText" class="status-text">Henüz kontrol edilmedi</div>
                <div id="lastChecked" class="meta"></div>
              </div>
            </div>

            <div class="status-pill" id="statusPill" aria-live="polite" style="margin-top:14px">
              <div class="dot" id="pillDot" aria-hidden="true" style="width:14px;height:14px;border-radius:50%"></div>
              <div>
                <div class="text" id="pillText">Henüz kontrol edilmedi</div>
                <div style="font-size:12px;color:rgba(255,255,255,.85)" id="pillSub"></div>
              </div>
            </div>

            <div class="stats-grid" role="region" aria-label="İstatistikler">
              <div class="stat">
                <div class="label">Toplam Kontrol</div>
                <div class="value" id="total">0</div>
              </div>
              <div class="stat">
                <div class="label">Çalışma Oranı</div>
                <div class="value" id="uptime">—</div>
              </div>
              <div class="stat">
                <div class="label">En Son Durum</div>
                <div class="value" id="lastStatus">—</div>
              </div>
              <div class="stat">
                <div class="label">Kayıt</div>
                <div class="value" id="saved">0</div>
              </div>
            </div>

            <!-- historyBox will render either rows (<=3) or a compact bullet list (>3) with internal scroll -->
            <div class="history" id="historyBox" aria-label="Kontrol geçmişi"></div>
          </div>
        </div>
      </div>

      <footer>Bu sayfa yalnızca cayadev.com erişilebilirliğini gösterir.</footer>
    </div>
  </div>

  <script>
    (function(){
      const TARGET = 'https://cayadev.com';
      const PROXY_BASE = 'https://api.allorigins.win/raw?url=';
      const INTERVAL_SECONDS = 60;

      const QUICK_RETRIES = 2;
      const RETRY_DELAY_MS = 2500;
      const REVERT_WINDOW_MS = 5 * 60 * 1000;

      const pill = document.getElementById('statusPill');
      const pillText = document.getElementById('pillText');
      const pillSub = document.getElementById('pillSub');
      const pillDot = document.getElementById('pillDot');
      const bigDot = document.getElementById('bigDot');
      const stateText = document.getElementById('stateText');
      const lastChecked = document.getElementById('lastChecked');
      const totalEl = document.getElementById('total');
      const uptimeEl = document.getElementById('uptime');
      const lastStatusEl = document.getElementById('lastStatus');
      const savedEl = document.getElementById('saved');
      const historyBox = document.getElementById('historyBox');

      const STORAGE_KEY = 'uptime:cayadev:clean-v3';
      let history = loadHistory();
      let timer = null;

      function loadHistory(){ try{ const r = localStorage.getItem(STORAGE_KEY); return r ? JSON.parse(r) : []; }catch(e){return[]} }
      function saveHistory(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(history)); }catch(e){}; savedEl.textContent = history.filter(h=>!h.reverted).length; }

      function pushRecord(ok, status){
        const rec = { t: new Date().toISOString(), ok: !!ok, status: status || null, reverted:false };
        history.unshift(rec);
        if(history.length>2000) history.length = 2000;
        saveHistory(); renderHistory();
      }

      function markRecentFailuresReverted(){
        const now = Date.now();
        for(let i=0;i<Math.min(6, history.length); i++){
          const r = history[i];
          if(!r || r.ok || r.reverted) continue;
          const t = new Date(r.t).getTime();
          if(now - t <= REVERT_WINDOW_MS) r.reverted = true;
        }
        saveHistory(); renderHistory();
      }

      function renderHistory(){
        historyBox.innerHTML = '';

        const items = history;
        if(items.length > 3){
          const ul = document.createElement('ul');
          ul.className = 'history-list';
          items.forEach(r=>{
            const li = document.createElement('li');
            const ts = document.createElement('span');
            ts.className = 'ts';
            ts.textContent = new Date(r.t).toLocaleString();
            const st = document.createElement('span');
            st.className = 'st';
            if(r.reverted){
              st.innerHTML = 'GERİ ALINDI' + (r.status ? ' ('+r.status+')' : '');
              st.style.opacity = '0.7';
            } else {
              st.innerHTML = (r.ok ? '<span style="color:var(--ok)">AKTİF</span>' : '<span style="color:var(--bad)">AKTİF DEĞİL</span>') + (r.status ? ' ('+r.status+')' : '');
            }
            li.appendChild(ts);
            li.appendChild(st);
            ul.appendChild(li);
          });
          historyBox.appendChild(ul);
        } else {
          items.forEach(r=>{
            const row = document.createElement('div');
            row.className = 'row' + (r.reverted ? ' reverted' : '');
            const left = document.createElement('div');
            left.innerHTML = `<small>${new Date(r.t).toLocaleString()}</small>`;
            const right = document.createElement('div');
            right.className = 'state';
            if(r.reverted){
              right.innerHTML = `<span>GERİ ALINDI ${r.status?('('+r.status+')'):''}</span>`;
            } else {
              right.innerHTML = r.ok ? `<span style="color:var(--ok)"><strong>AKTİF</strong> ${r.status?('('+r.status+')'):''}</span>` : `<span style="color:var(--bad)"><strong>AKTİF DEĞİL</strong> ${r.status?('('+r.status+')'):''}</span>`;
            }
            row.appendChild(left); row.appendChild(right);
            historyBox.appendChild(row);
          });
        }

        const counted = history.filter(h=>!h.reverted);
        totalEl.textContent = counted.length;
        const ups = counted.filter(h=>h.ok).length;
        uptimeEl.textContent = counted.length ? Math.round(ups/counted.length*100) + '%' : '—';
        lastStatusEl.textContent = counted.length ? (counted[0].ok ? 'AKTİF' : 'AKTİF DEĞİL') : '—';
      }

      function setVisual(ok, status){
        if(ok){
          pill.classList.remove('bad'); pill.classList.add('ok');
          pillDot.style.background = '#fff';
          pillText.textContent = 'AKTİF';
          pillSub.textContent = status ? 'HTTP ' + status : 'Erişilebilir';
          bigDot.className = 'big-dot up';
          stateText.innerHTML = `<strong style="color:var(--ok)">AKTİF</strong> ${status?('('+status+')'):''}`;
        } else {
          pill.classList.remove('ok'); pill.classList.add('bad');
          pillDot.style.background = '#fff';
          pillText.textContent = 'AKTİF DEĞİL';
          pillSub.textContent = status ? (status === 'err' ? 'Bağlantı hatası' : 'HTTP ' + status) : 'Erişilemiyor';
          bigDot.className = 'big-dot down';
          stateText.innerHTML = `<strong style="color:var(--bad)">AKTİF DEĞİL</strong> ${status?('('+status+')'):''}`;
        }
        lastChecked.textContent = 'Son kontrol: ' + new Date().toLocaleString();
      }

      function buildUrl(){ return PROXY_BASE + encodeURIComponent(TARGET); }

      async function tryFetch(method, signal){
        try{
          const res = await fetch(buildUrl(), { method, cache:'no-store', signal });
          return { ok: res.ok, status: res.status };
        }catch(e){
          return { ok:false, status:'err' };
        }
      }

      async function checkOnce(){
        const controller = new AbortController();
        const timeout = setTimeout(()=>controller.abort(), 15000);
        try{
          let head = await tryFetch('HEAD', controller.signal);
          if(head.status !== 'err' && typeof head.status === 'number'){
            clearTimeout(timeout);
            setVisual(head.ok, head.status);
            pushRecord(head.ok, head.status);
            if(head.ok) markRecentFailuresReverted();
            return;
          }

          let final = null;
          for(let i=0;i<=QUICK_RETRIES;i++){
            const method = (i===QUICK_RETRIES) ? 'GET' : 'HEAD';
            const r = await tryFetch(method, controller.signal);
            if(r.status !== 'err' || r.ok){ final = r; break; }
            if(i<QUICK_RETRIES) await new Promise(r=>setTimeout(r, RETRY_DELAY_MS));
          }

          clearTimeout(timeout);

          if(final){
            setVisual(final.ok, final.status);
            pushRecord(final.ok, final.status);
            if(final.ok) markRecentFailuresReverted();
          } else {
            setVisual(false, 'err');
            pushRecord(false, 'err');
          }
        }catch(e){
          clearTimeout(timeout);
          setVisual(false, 'err');
          pushRecord(false, 'err');
        }
      }

      function start(){
        if(timer) clearInterval(timer);
        checkOnce();
        timer = setInterval(checkOnce, INTERVAL_SECONDS * 1000);
      }

      // init
      renderHistory();
      window.addEventListener('load', start);
      document.addEventListener('visibilitychange', ()=>{
        if(document.hidden){ if(timer){ clearInterval(timer); timer = null; } }
        else start();
      });

      console.info('Aside kaldırıldı; arayüz temizlendi.');
    })();
  </script>
</body>
</html>